<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Bintangin Dulu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="icon" href="data:image/svg+xml,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
    <text y='.9em' font-size='90'>‚≠ê</text>
  </svg>">

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f8f9fa; color: #333; }
    header { background: #4f46e5; color: white; padding: 1rem; text-align: center; }
    h1 { margin: 0; }

    .container { max-width: 900px; margin: 1rem auto; padding: 1rem; }

    .btn { background: #4f46e5; color: white; border: none; padding: 0.7rem 1.2rem; border-radius: 8px; cursor: pointer; transition: 0.3s; }
    .btn:hover { background: #4338ca; }

.card { 
  background: white; 
  border-radius: 20px; 
  box-shadow: 0 2px 6px rgba(0,0,0,0.1); 
  padding: 1rem; 
  display: flex; 
  flex-direction: column; 
  justify-content: center; 
  margin: 0.5rem 0; 

  /* ini untuk teks dalam 1 paragraf */
  line-height: 1.4; 

  /* jaga teks panjang */
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.card strong { 
  color: #000000; 
  margin-bottom: 0.3rem; /* jarak ke bawah */
}

.card > div { 
  margin-bottom: 0.4rem; /* antar div ada spasi */
}

.card > div:last-child { 
  margin-bottom: 0; /* div terakhir (URL) tanpa spasi tambahan */
}

.card a {
  color: blue;
  text-decoration: underline;
  word-break: break-all; /* kalau URL panjang banget */
}



    .search-box { display: flex; align-items: center; margin: 1rem 0; }
    .search-box input { flex: 1; padding: 0.7rem; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; }
    .search-box input:focus { border-color: #4f46e5; outline: none; box-shadow: 0 0 5px rgba(79,70,229,0.5); }

    /* Pagination */
    #pagination { display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; margin-top: 1rem; }
    #pagination button { padding: 0.5rem 0.8rem; border: none; border-radius: 6px; background: #e5e7eb; cursor: pointer; }
    #pagination button.active { background: #4f46e5; color: white; }
    #pagination span { padding: 0.5rem 0.8rem; color: #666; }

    /* Modal */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 1.5rem; border-radius: 10px; max-width: 400px; width: 90%; position: relative; }
    .modal-content h2 { margin-top: 0; }
    .close { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 1.2rem; }

    /* Form */
    .modal-content input, .modal-content textarea { width: 93%; margin: 0.5rem 0; padding: 0.7rem; border: 1px solid #ccc; border-radius: 8px; }
    .modal-content input:focus, .modal-content textarea:focus { border-color: #4f46e5; outline: none; }

    /* Loader */
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: auto; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    #overlayLoader { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.7); justify-content:center; align-items:center; z-index: 1000; }

.toast {
  background: #16a34a;
  color: white;
  padding: 0.3rem 0.5rem;
  border-radius: 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  display: none;
}


    @media(max-width: 600px) {
      .card { font-size: 0.9rem; }
      .search-box input { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Bintangin Dulu ‚≠ê‚≠ê‚≠ê</h1>
  </header>

  <div class="container">
    <button class="btn" onclick="openModal()">‚≠ê Tambah Saran</button>
      <div class="toast" id="toast">‚úÖ Saran berhasil dikirim!</div>

    <div class="search-box">
      <input type="text" id="search" placeholder="üîç Cari berdasarkan nama, bagian, atau saran...">
    </div>

    <div id="listSaran"></div>
    <div id="pagination"></div>
  </div>

  <!-- Modal Input -->
  <div class="modal" id="modalForm">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>Tambah Saran</h2>
      <form id="saranForm">
        <input type="text" name="Nama" placeholder="Nama" required>
        <input type="text" name="Bagian" placeholder="Bagian" required>
        <textarea name="Saran" placeholder="Tulis saran..." required></textarea>
        <input type="url" name="Url" placeholder="URL terkait (opsional)">
        <button class="btn" type="submit">Kirim</button>
      </form>
      <div class="loader" id="formLoader" style="display:none;"></div>
    </div>
  </div>

  <!-- Overlay Loader (Fetch data) -->
  <div id="overlayLoader"><div class="loader"></div></div>



  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbz8H2LM-5YQUtwB7rohxMqbeIFj6big8m-77kJkecG83z4YnHngsLA_5_EzdKIhGCeM/exec"; // Ganti dengan URL Web App Google Apps Script
    let currentPage = 1;
    const perPage = 5;
    let allData = [];

    function showOverlayLoader() { document.getElementById("overlayLoader").style.display = "flex"; }
    function hideOverlayLoader() { document.getElementById("overlayLoader").style.display = "none"; }

    // async function loadData() {
    //   showOverlayLoader();
    //   const res = await fetch(API_URL);
    //   allData = await res.json();
    //   hideOverlayLoader();
    //   renderList();
    // }

    async function loadData() {
  showOverlayLoader();
  const res = await fetch(API_URL);
  allData = await res.json();

  // balik urutan biar yang baru di atas
  allData = allData.reverse();

  hideOverlayLoader();
  renderList();
}


    function renderList() {
      const search = document.getElementById('search').value.toLowerCase();
      const filtered = allData.filter(item =>
        item.Nama.toLowerCase().includes(search) ||
        item.Bagian.toLowerCase().includes(search) ||
        item.Saran.toLowerCase().includes(search)
      );

      const start = (currentPage - 1) * perPage;
      const paginated = filtered.slice(start, start + perPage);

      document.getElementById("listSaran").innerHTML = paginated.map(d => `
        <div class="card" >
          <strong>${d.Nama} (${d.Bagian})</strong>
          <div>${d.Saran}</div>
          <div>${d.Url ? `<a href="${d.Url}" target="_blank">${d.Url}</a>` : ""}</div>
        </div>
      `).join("");

      renderPagination(Math.ceil(filtered.length / perPage), currentPage);
    }

    function renderPagination(totalPages, currentPage) {
      const pagination = document.getElementById("pagination");
      let buttons = "";

      if (currentPage > 1) {
        buttons += `<button onclick="gotoPage(${currentPage - 1})">¬´ Prev</button>`;
      }

      if (currentPage > 3) {
        buttons += `<button onclick="gotoPage(1)">1</button>`;
        if (currentPage > 4) buttons += `<span>...</span>`;
      }

      for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
        buttons += `<button onclick="gotoPage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
      }

      if (currentPage < totalPages - 2) {
        if (currentPage < totalPages - 3) buttons += `<span>...</span>`;
        buttons += `<button onclick="gotoPage(${totalPages})">${totalPages}</button>`;
      }

      if (currentPage < totalPages) {
        buttons += `<button onclick="gotoPage(${currentPage + 1})">Next ¬ª</button>`;
      }

      pagination.innerHTML = buttons;
    }

    function gotoPage(p) {
      currentPage = p;
      renderList();
    }

    function openModal() { document.getElementById("modalForm").style.display = "flex"; }
    function closeModal() { document.getElementById("modalForm").style.display = "none"; }

    document.getElementById("saranForm").addEventListener("submit", async e => {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(e.target).entries());
      document.getElementById("formLoader").style.display = "block";

      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(formData)
      });

      document.getElementById("formLoader").style.display = "none";
      e.target.reset();
      closeModal();
      showToast();
      loadData();
    });

    document.getElementById("search").addEventListener("input", renderList);

    function showToast() {
      const toast = document.getElementById("toast");
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 3000);
    }

    loadData();
  </script>
</body>
</html>
